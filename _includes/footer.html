<footer class="site-footer">
    <!-- CTA Banner -->
    <div class="footer-cta">
        <div class="container">
            <span class="footer-cta-text">üìú ¬øTienes fotograf√≠as hist√≥ricas de Parral? ¬°Ay√∫danos a preservar la
                memoria!</span>
            <a href="{{ '/participa.html' | relative_url }}" class="footer-cta-btn">Participar ‚Üí</a>
        </div>
    </div>

    <!-- Main Footer Content -->
    <div class="footer-main">
        <div class="container">
            <div class="footer-grid">
                <!-- Brand Column -->
                <div class="footer-brand">
                    <h3 class="footer-logo">Archivos en Movimiento</h3>
                    <p class="footer-tagline">Patrimonio Vivo de Parral</p>
                    <p class="footer-description">Museo digital que preserva y difunde la historia visual de nuestra
                        comuna a trav√©s de la restauraci√≥n con Inteligencia Artificial.</p>
                    <div class="footer-badge">
                        <span>üèõÔ∏è</span> Museo Digital desde 2024
                    </div>
                </div>

                <!-- Navigation Column -->
                <div class="footer-nav-col">
                    <h4>Explorar</h4>
                    <ul>
                        <li><a href="{{ '/index.html' | relative_url }}">Inicio</a></li>
                        <li><a href="{{ '/galeria.html' | relative_url }}">Galer√≠a Digital</a></li>
                        <li><a href="{{ '/educacion.html' | relative_url }}">Material Educativo</a></li>
                        <li><a href="{{ '/historia.html' | relative_url }}">L√≠nea de Tiempo</a></li>
                        <li><a href="{{ '/personajes.html' | relative_url }}">Personajes</a></li>
                        <li><a href="{{ '/colonias.html' | relative_url }}">Colonias</a></li>
                    </ul>
                </div>

                <!-- Project Column -->
                <div class="footer-nav-col">
                    <h4>El Proyecto</h4>
                    <ul>
                        <li><a href="{{ '/sobre.html' | relative_url }}">Sobre el Proyecto</a></li>
                        <li><a href="{{ '/metodologia.html' | relative_url }}">Metodolog√≠a IA</a></li>
                        <li><a href="{{ '/participa.html' | relative_url }}">C√≥mo Participar</a></li>
                        <li><a href="{{ '/relatos.html' | relative_url }}">Biblioteca de Memorias</a></li>
                    </ul>
                </div>

                <!-- Institutional Column -->
                <div class="footer-nav-col" style="grid-column: span 1;">
                    <h4>Ejecuta</h4>
                    <div
                        style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 10px; border: 1px solid rgba(255,255,255,0.1);">
                        <p style="color: #c9a961; font-weight: bold; margin-bottom: 0.5rem; font-size: 0.9rem;">
                            Agrupaci√≥n Amigos Parralinos por el CEIA</p>
                        <p style="font-size: 0.8rem; line-height: 1.4; opacity: 0.8;">PJ N¬∞ 1321 - Parral</p>
                        <p style="font-size: 0.8rem; line-height: 1.4; opacity: 0.8;">Beneficiaria Fondos P√∫blicos 2024
                        </p>
                    </div>
                </div>

                <!-- Contact Column -->
                <div class="footer-contact">
                    <h4>Contacto</h4>
                    <a href="mailto:profepablo2010@gmail.com" class="footer-email">
                        <span>‚úâÔ∏è</span> profepablo2010@gmail.com
                    </a>
                    <a href="https://wa.me/56984668005?text=Hola%2C%20vengo%20desde%20Archivos%20en%20Movimiento"
                        class="footer-whatsapp" target="_blank" rel="noopener">
                        <span>üí¨</span> WhatsApp
                    </a>
                    <div class="footer-location">
                        <span>üìç</span> Parral, Regi√≥n del Maule, Chile
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Bottom -->
    <div class="footer-bottom">
        <div class="container">
            <p>&copy; 2025 Archivos en Movimiento. Todos los derechos reservados.</p>
            <p class="footer-credits">Creado con ‚ù§Ô∏è en Parral, Chile</p>
        </div>
    </div>
</footer>

<!-- Global Chatbot Widget -->
<div class="chat-widget">
    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <img src="images/ecos-neruda-nace.jpg" alt="El Guardador de Memorias" class="chat-avatar">
            <div class="chat-header-info">
                <h4>El Guardador de Memorias</h4>
                <span>Esencia de Parral</span>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="message bot">
                Bienvenido viajero del tiempo. Soy el Guardador de las Memorias de Parral. En mis susurros encontrar√°s
                la historia de nuestra Villa Reina Luisa, los versos de Neftal√≠ y el rugido del tren. ¬øQu√© secreto de
                nuestra tierra buscas hoy?
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="chatInput" placeholder="Preg√∫ntame por nuestra historia...">
            <button class="chat-send-btn" id="sendBtn" aria-label="Enviar mensaje">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>
    <div class="chat-bubble" id="chatBubble" title="Conversar con las memorias">
        <span>üìú</span>
    </div>
</div>

<!-- Scripts -->
<script src="{{ '/js/site-nav.js' | relative_url }}"></script>
<script src="{{ '/js/home.js' | relative_url }}"></script>

<script>
    // Global Chatbot Logic - "El Guardador de Memorias"
    (function () {
        const chatBubble = document.getElementById('chatBubble');
        const chatWindow = document.getElementById('chatWindow');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');

        if (!chatBubble) return;

        chatBubble.addEventListener('click', () => {
            chatWindow.classList.toggle('show');
        });

        function addMessage(text, side, link = null, linkText = null) {
            const msg = document.createElement('div');
            msg.className = `message ${side}`;
            msg.textContent = text;

            if (link) {
                const a = document.createElement('a');
                a.href = link;
                a.className = 'chat-response-link';
                a.textContent = linkText || 'Saber m√°s';
                msg.appendChild(a);
            }

            chatMessages.appendChild(msg);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        const knowledgeBase = [
            {
                keys: ['neruda', 'pablo', 'neftali', 'poeta', 'literatura', 'nobel', '1904', '1971', 'ricardo', 'reyes'],
                text: 'Pablo Neruda (nacido como Ricardo Eli√©cer Neftal√≠ Reyes Basoalto en 1904) es nuestro hijo m√°s ilustre. Premio Nobel en 1971, su infancia en Parral marc√≥ su poes√≠a. Puedes visitar su monumento y conocer su legado en nuestra secci√≥n de personajes.',
                link: 'personajes.html',
                linkText: 'Ver Personajes Destacados'
            },
            {
                keys: ['maza', 'astronomia', 'ciencia', 'educacion', 'profe', 'jose'],
                text: 'El Profe Jos√© Maza es otro gran orgullo parralino, llevando el nombre de nuestra tierra a las estrellas con su inmensa labor educativa y astron√≥mica.',
                link: 'personajes.html',
                linkText: 'Ver Personajes Destacados'
            },
            {
                keys: ['chanca', 'ignacio', 'urrutia', 'rodeo', 'campeon', 'jinete'],
                text: 'Don Chanca (Ignacio Urrutia) fue una leyenda del rodeo chileno y Champion de Chile. Un verdadero maestro de nuestras tradiciones corraleras.',
                link: 'personajes.html',
                linkText: 'Ver Personajes Destacados'
            },
            {
                keys: ['guaton', 'loyola', 'cueca', 'rodeo', 'historia', 'mito', 'fiesta'],
                text: '¬øSab√≠as que el Guat√≥n Loyola es m√°s que una cueca? Su historia real ocurri√≥ en el rodeo de Parral, convirti√©ndose en un mito de nuestra cultura popular.',
                link: 'detalle-guaton.html',
                linkText: 'Leer el relato del Guat√≥n Loyola'
            },
            {
                keys: ['historia', 'fundacion', '1795', 'reina luisa', 'ambrosio', 'ohiggins', 'villa', 'cronologia'],
                text: 'La Villa Reina Luisa del Parral fue fundada en 1795 por mandato de de Ambrosio OHiggins. Desde entonces, hemos crecido como un centro de cultura y resiliencia en el coraz√≥n de Chile.',
                link: 'historia.html',
                linkText: 'Explorar L√≠nea de Tiempo'
            },
            {
                keys: ['delegacion', '1823', 'organizacion', 'politica'],
                text: 'En 1823, Parral se constituy√≥ como una delegaci√≥n administrativa, marcando un hito en nuestra organizaci√≥n pol√≠tica formal.',
                link: 'historia.html',
                linkText: 'Ver Historia'
            },
            {
                keys: ['tren', 'ferrocarril', 'progreso', '1870', 'estacion', 'vias', 'locomotora'],
                text: 'La llegada del ferrocarril cerca de 1870 trajo el "Rugido del Progreso", conectando a Parral con el pa√≠s e impulsando nuestra econom√≠a y sociedad.',
                link: 'historia.html',
                linkText: 'Ver Historia del Tren'
            },
            {
                keys: ['perquilauquen', 'puente', 'acero', '1896', 'rio', 'ingenieria'],
                text: 'El majestuoso puente de acero sobre el r√≠o Perquilauqu√©n, inaugurado en 1896, es un gigante de la ingenier√≠a y un s√≠mbolo eterno de nuestra zona.',
                link: 'historia.html',
                linkText: 'Ver Hitos Hist√≥ricos'
            },
            {
                keys: ['terremoto', '1939', 'chillan', 'reconstruccion', 'catastrofe', 'sismo'],
                text: 'El devastador terremoto de 1939 cambi√≥ nuestra arquitectura, pasando de lo colonial a una reconstrucci√≥n moderna que define el Parral actual.',
                link: 'historia.html',
                linkText: 'Ver Historia'
            },
            {
                keys: ['colonia', 'italiana', 'italianos', 'san manuel', '1950', 'abruzzi', 'trentino', 'cicchelli', 'colonos'],
                text: 'La Colonia Italiana de San Manuel naci√≥ en 1950 como un sue√±o de 153 colonos que llegaron desde Italia tras la guerra. Un legado de esfuerzo y cultura que a√∫n persiste.',
                link: 'colonias.html',
                linkText: 'Conocer las Colonias'
            },
            {
                keys: ['colonia', 'alemana', 'alemanes', 'dignidad', '1961', 'schafer', 'baviera', 'colonos', 'villa baviera'],
                text: 'En 1961 se instal√≥ la Colonia Dignidad en la precordillera, un cap√≠tulo complejo y oscuro que forma parte de nuestra memoria hist√≥rica regional.',
                link: 'colonias.html',
                linkText: 'Ver Ra√≠ces Europeas'
            },
            {
                keys: ['educacion', 'guia', 'pdf', 'material', 'docente', 'colorear', 'profesor', 'juego', 'trivia', 'infografia', 'pedagogico'],
                text: '¬°Tenemos much√≠simos recursos educativos! Desde l√°minas para colorear hasta gu√≠as pedag√≥gicas en PDF para todos los niveles escolares (Parvularia, B√°sica y Media).',
                link: 'educacion.html',
                linkText: 'Ir a Material Educativo'
            },
            {
                keys: ['alcalde', 'autoridad', 'solar', 'nieves', 'spoerer', 'politica', 'municipio', 'alcaldesa'],
                text: 'Desde nuestro primer alcalde Domingo Antonio Solar en 1912 hasta figuras como Nieves Spoerer en 1953, Parral ha sido forjado por grandes l√≠deres.',
                link: 'alcaldes.html',
                linkText: 'Ver L√≠nea de Alcaldes'
            },
            {
                keys: ['turismo', 'catillo', 'digua', 'termas', 'vacaciones', 'naturaleza', 'ba√±os', 'embalse', 'aguas'],
                text: 'Descubre las aguas sanadoras de las Termas de Catillo o el hermoso paisaje del Embalse Digua. Parral es naturaleza y descanso.',
                link: 'turismo.html',
                linkText: 'Ver Destinos Tur√≠sticos'
            },
            {
                keys: ['ia', 'inteligencia', 'artificial', 'restaurado', 'coloreado', 'original', 'metodologia', 'etica'],
                text: 'Nuestra √©tica es "Restauraci√≥n, no invenci√≥n". Usamos IA para devolverle la luz a los archivos originales sin inventar lo que no existi√≥ en ellos.',
                link: 'metodologia.html',
                linkText: 'Nuestra Metodolog√≠a √âtica'
            },
            {
                keys: ['plaza', 'armas', 'kiosco', 'odeon', 'centro', 'plaza'],
                text: 'La Plaza de Armas es el coraz√≥n de Parral. En la galer√≠a puedes ver c√≥mo ha cambiado desde principios del siglo XX, incluyendo su ic√≥nico quiosco u ode√≥n.',
                link: 'galeria.html',
                linkText: 'Ver Plaza de Armas'
            },
            {
                keys: ['bomberos', 'fuego', 'cuartel', 'voluntarios', 'emergencia', 'hachas', 'escaleras'],
                text: 'Los Bomberos de Parral tienen una historia de valor incalculable. Tenemos registros restaurados de sus primeros carros y voluntarios.',
                link: 'galeria.html',
                linkText: 'Ver Bomberos de Parral'
            },
            {
                keys: ['inundacion', '1965', 'rio', 'agua', 'catastrofe', 'desborde'],
                text: 'La inundaci√≥n de 1965 marc√≥ un antes y un despu√©s en la resiliencia de nuestra gente. Tenemos registros fotogr√°ficos impactantes de ese evento.',
                link: 'galeria.html',
                linkText: 'Ver Galer√≠a Hist√≥rica'
            },
            {
                keys: ['arroz', 'arrozales', 'cultivo', 'campo', 'agricultura', 'siembra', 'rural', 'lechero', 'cochayullo'],
                text: 'Parral es la capital arrocera de Chile. Nuestra historia rural, con personajes como el lechero y escenas del ni√±o cochayullo, es el latido de nuestra tradici√≥n.',
                link: 'galeria.html',
                linkText: 'Ver Vida Rural'
            },
            {
                keys: ['participa', 'ayudar', 'colaborar', 'donar', 'relato', 'contacto', 'unete'],
                text: 'Este es un Archivo en Movimiento. Si tienes fotos o historias de tu familia en Parral, ¬°√∫nete y ay√∫danos a que la memoria no se pierda!',
                link: 'participa.html',
                linkText: '¬°Participa aqu√≠!'
            },
            {
                keys: ['vehiculos', 'autos', 'transporte', 'citroneta', 'bonanza', 'micro', 'colectivo', 'camion'],
                text: 'Los veh√≠culos hist√≥ricos de Parral cuentan la evoluci√≥n de nuestro transporte. Desde la cl√°sica Citroneta hasta la Micro Bonanza y el Bus Cinta Azul, ¬°ven a verlos!',
                link: 'galeria.html',
                linkText: 'Ver Veh√≠culos Hist√≥ricos'
            },
            {
                keys: ['feria', 'mercado', 'comercio', 'libres', 'sabores', 'tradicion', 'feriantes'],
                text: 'Las Ferias Libres y el Mercado Municipal son el coraz√≥n comercial de Parral. Tenemos nuevas fotos restauradas que capturan su vitalidad y ambiente.',
                link: 'galeria.html',
                linkText: 'Ver Ferias y Mercado'
            },
            {
                keys: ['hospital', 'salud', 'medicina', 'doctores', 'enfermeras', 'urgencia', 'operacion'],
                text: 'El Hospital de Parral tiene una larga historia de servicio a la comunidad. Contamos con registros de cirug√≠as antiguas, el exterior del edificio y escenas de la antigua urgencia.',
                link: 'galeria.html',
                linkText: 'Ver Hospital'
            },
            {
                keys: ['locales', 'tiendas', 'comercio', 'universo', 'casa real', 'aurita', 'negocios'],
                text: 'Los locales comerciales hist√≥ricos, como "El Universo", "Casa Real" y "La Aurita", fueron el centro de la vida social parralina. ¬°Descubre sus fachadas restauradas!',
                link: 'galeria.html',
                linkText: 'Ver Locales Comerciales'
            },
            {
                keys: ['san francisco', 'convento', 'templo', 'iglesia', '1900', 'religion'],
                text: 'El Templo San Francisco y su convento son piezas clave de nuestra historia. Tenemos nuevas fotos de 1900 y recreaciones en video que te sorprender√°n.',
                link: 'galeria.html',
                linkText: 'Ver Templo San Francisco'
            },
            {
                keys: ['colegios', 'escuela 7', 'escuela de ni√±as', 'educacion', 'liceo', 'estudiantes'],
                text: 'La educaci√≥n de Parral se refleja en sus edificios hist√≥ricos como la Escuela de Ni√±as y la emblem√°tica Escuela 7. ¬°Revive tus a√±os escolares!',
                link: 'galeria.html',
                linkText: 'Ver Colegios'
            },
            {
                keys: ['casas', 'radio el roble', 'terremoto 1939', 'arquitectura', 'adobe', 'entrada'],
                text: 'Descubre la arquitectura antigua de Parral, los ecos de la Radio El Roble y los registros del devastador terremoto de 1939.',
                link: 'galeria.html',
                linkText: 'Ver Casas Antiguas'
            }
        ];

        function normalizeText(text) {
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();
        }

        function getLevenshteinDistance(a, b) {
            const matrix = [];
            for (let i = 0; i <= b.length; i++) matrix[i] = [i];
            for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
            for (let i = 1; i <= b.length; i++) {
                for (let j = 1; j <= a.length; j++) {
                    if (b.charAt(i - 1) === a.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                    }
                }
            }
            return matrix[b.length][a.length];
        }

        function handleBotResponse(input) {
            const query = normalizeText(input);
            const queryWords = query.split(/\s+/);

            let bestMatch = null;
            let highestScore = 0;

            knowledgeBase.forEach(item => {
                let score = 0;
                item.keys.forEach(key => {
                    const normKey = normalizeText(key);

                    // 1. Coincidencia de frase exacta (Prioridad m√°xima)
                    if (query === normKey) {
                        score += 50;
                    }
                    // 2. Query contiene frase (Solo si es larga)
                    else if (normKey.length > 3 && query.includes(normKey)) {
                        score += 20;
                    }

                    // 3. Palabra por palabra
                    queryWords.forEach(word => {
                        if (word.length < 3) return;

                        // Match exacto de palabra
                        if (normKey === word) {
                            score += 15;
                        }
                        // Fuzzy match (solo para palabras largas)
                        else if (word.length >= 4 && normKey.length >= 4) {
                            const dist = getLevenshteinDistance(word, normKey);
                            const maxError = normKey.length > 6 ? 2 : 1;
                            if (dist <= maxError) score += 5;
                        }
                    });
                });

                if (score > highestScore) {
                    highestScore = score;
                    bestMatch = item;
                }
            });

            setTimeout(() => {
                // Umbral m√≠nimo de score para evitar falsos positivos
                if (bestMatch && highestScore >= 15) {
                    addMessage(bestMatch.text, 'bot', bestMatch.link, bestMatch.linkText);
                } else {
                    addMessage('Mis susurros a√∫n no contienen esa historia espec√≠fica, pero puedes explorar nuestra galer√≠a o enviarnos tu propio relato para que la memoria siga creciendo.', 'bot');
                }
            }, 600);
        }

        sendBtn.addEventListener('click', () => {
            const text = chatInput.value.trim();
            if (text) {
                addMessage(text, 'user');
                chatInput.value = '';
                handleBotResponse(text);
            }
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendBtn.click();
        });
    })();
</script>
<script src="{{ '/js/accesibilidad.js' | relative_url }}"></script>
<script src="{{ '/js/audio-helper.js' | relative_url }}"></script>
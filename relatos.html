<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatos y Tradiciones ‚Äì Archivos en Movimiento</title>
    <meta name="description"
        content="Escucha la voz viva de Parral: testimonios, leyendas y relatos de nuestra gente y personajes ilustres.">

    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Relatos y Tradiciones de Parral | Archivos en Movimiento">
    <meta property="og:description"
        content="Testimonios en video y relatos escritos sobre la cultura y el folclore de Parral. Personajes ilustres como Neruda y el Guat√≥n Loyola.">
    <meta property="og:image" content="https://fotos-parral.cl/optimized/images/epoca-portada.webp">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Merriweather:wght@300;400;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <div class="container">
            <div class="logo-area">
                <h1><a href="index.html">Archivos en Movimiento</a></h1>
                <p class="subtitle">Patrimonio Vivo de Parral</p>
            </div>
            <button class="mobile-menu-btn" aria-label="Men√∫">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="galeria.html">Galer√≠a</a></li>
                    <li><a href="relatos.html" class="active">Relatos</a></li>
                    <li><a href="educacion.html">Educaci√≥n</a></li>
                    <li><a href="historia.html">Historia</a></li>
                    <li><a href="mapa.html">Mapa</a></li>
                    <li><a href="participa.html" class="btn-nav">¬°Participa!</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero"
        style="background: linear-gradient(180deg, #0a0a0a 0%, #1a1a1a 100%); padding: 4rem 1rem 3rem; min-height: auto;">
        <div class="container" style="text-align: center;">
            <h2 class="hero-title-dual">
                <span class="title-white">Relatos y</span>
                <span class="title-gold">Tradiciones</span>
            </h2>
            <p style="color: rgba(255,255,255,0.7); margin-top: 1rem;">La voz viva de nuestra gente</p>
        </div>
    </section>

    <section class="container" style="padding: 4rem 1rem;">
        <h3 style="text-align: left; margin-bottom: 2rem;">Personajes Ilustres</h3>
        <div class="grid-galeria">
            <div class="card-testimonio">
                <h4>Pablo Neruda</h4>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/ejoaLJy4FkQ"
                        title="Pablo Neruda - La cuna olvidada del poeta"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
                </div>
            </div>
            <div class="card-testimonio">
                <h4>Profe Maza</h4>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/OpSmKTgePek"
                        title="Profe Maza - Legado educativo y astron√≥mico"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
                </div>
            </div>
            <div class="card-testimonio">
                <h4>Ignacio Urrutia</h4>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/Eaj5YyAry7o"
                        title="Ignacio Urrutia - Don Chanca Maestro del Rodeo"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
                </div>
            </div>
            <div class="card-testimonio">
                <h4>El Guat√≥n Loyola</h4>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/TPGcPPh1F00"
                        title="El Guat√≥n Loyola - Historia de un mito"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
                </div>
            </div>
        </div>

        <h3 style="text-align: left; margin: 4rem 0 2rem;">Oficios y Tradiciones</h3>
        <div class="grid-galeria">
            <!-- Enlace a Historia -->
            <a href="detalle-historia.html" class="card-foto"
                style="text-decoration: none; color: inherit; display: block;">
                <div class="card-testimonio" style="height: 100%;">
                    <h4>Historia de Parral</h4>
                    <p>Un viaje por la historia del trabajo en nuestra comunidad.</p>
                    <span
                        style="display: inline-block; margin-top: 1rem; color: var(--color-primary); font-weight: bold; font-size: 0.9rem;">Ver
                        cronolog√≠a &rarr;</span>
                </div>
            </a>

            <div class="card-testimonio">
                <h4>Video Hist√≥rico de Parral</h4>
                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/gAi89JZfXEs?si=N-OuykZ7q6XJg2l_"
                        title="Video Hist√≥rico de Parral"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen></iframe>
                </div>
            </div>

            <!-- Enlace a El Guat√≥n Loyola -->
            <a href="detalle-guaton.html" class="card-foto"
                style="text-decoration: none; color: inherit; display: block;">
                <div class="card-testimonio" style="height: 100%;">
                    <h4>El Guat√≥n Loyola</h4>
                    <p>La verdadera historia de la cueca y su origen en el rodeo de Parral.</p>
                    <span
                        style="display: inline-block; margin-top: 1rem; color: var(--color-primary); font-weight: bold; font-size: 0.9rem;">Leer
                        relato &rarr;</span>
                </div>
            </a>

            <div class="card-testimonio">
                <h4>Historias Locales</h4>
                <p>Mitos, leyendas y an√©cdotas de los barrios.</p>
            </div>
            <!-- Enlace a Alcaldes -->
            <a href="alcaldes.html" class="card-foto" style="text-decoration: none; color: inherit; display: block;">
                <div class="card-testimonio" style="height: 100%;">
                    <h4>Alcaldes</h4>
                    <p>Registro completo de las autoridades comunales.</p>
                    <span
                        style="display: inline-block; margin-top: 1rem; color: var(--color-primary); font-weight: bold; font-size: 0.9rem;">Ver
                        registro &rarr;</span>
                </div>
            </a>
        </div>
    </section>

    <footer>
        <div class="container">
            <p>&copy; 2025 Archivos en Movimiento. Patrimonio Vivo de Parral.</p>
            <p style="font-size: 0.9rem;">
                <a href="metodologia.html" style="color: var(--accent-color); text-decoration: none;">Metodolog√≠a √âtica</a>
                |
                Modelo replicable para la gesti√≥n cultural municipal.
            </p>
        </div>
    </footer>

    <!-- Global Chatbot Widget -->
    <div class="chat-widget">
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <img src="images/ecos-neruda-nace.jpg" alt="El Guardador de Memorias" class="chat-avatar">
                <div class="chat-header-info">
                    <h4>El Guardador de Memorias</h4>
                    <span>Esencia de Parral</span>
                </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    Bienvenido viajero del tiempo. Soy el Guardador de las Memorias de Parral. En mis susurros encontrar√°s
                    la historia de nuestra Villa Reina Luisa, los versos de Neftal√≠ y el rugido del tren. ¬øQu√© secreto de
                    nuestra tierra buscas hoy?
                </div>
            </div>
            <div class="chat-input-area">
                <input type="text" class="chat-input" id="chatInput" placeholder="Preg√∫ntame por nuestra historia...">
                <button class="chat-send-btn" id="sendBtn" aria-label="Enviar mensaje">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
        <div class="chat-bubble" id="chatBubble" title="Conversar con las memorias">
            <span>üìú</span>
        </div>
    </div>

    <!-- Main JavaScript File -->
    <script src="js/home.js"></script>

    <script>
        // Global Chatbot Logic - "El Guardador de Memorias"
        (function () {
            const chatBubble = document.getElementById('chatBubble');
            const chatWindow = document.getElementById('chatWindow');
            const chatMessages = document.getElementById('chatMessages');
            const chatInput = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');

            if (!chatBubble) return;

            chatBubble.addEventListener('click', () => {
                chatWindow.classList.toggle('show');
            });

            function addMessage(text, side, link = null, linkText = null) {
                const msg = document.createElement('div');
                msg.className = `message ${side}`;
                msg.textContent = text;

                if (link) {
                    const a = document.createElement('a');
                    a.href = link;
                    a.className = 'chat-response-link';
                    a.textContent = linkText || 'Saber m√°s';
                    msg.appendChild(a);
                }

                chatMessages.appendChild(msg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            const knowledgeBase = [
                {
                    keys: ['neruda', 'pablo', 'neftal√≠', 'poeta', 'literatura', 'nobel', '1904'],
                    text: 'Pablo Neruda, nacido como Ricardo Eli√©cer Neftal√≠ Reyes Basoalto aqu√≠ en Parral en 1904, es la voz que nos puso en el mapa del mundo. Su primera casa a√∫n susurra sus versos.',
                    link: 'relatos.html',
                    linkText: 'Ver Relatos de Neruda'
                },
                {
                    keys: ['galeria', 'fotos', 'im√°genes', 'ia', 'restaurado', 'restauraci√≥n', 'curadur√≠a', 'original'],
                    text: 'Cuidamos la memoria con "Restauraci√≥n, no invenci√≥n". Usamos IA para devolverle la luz a los archivos originales de la Plaza de Armas y Bomberos, sin inventar lo que no existi√≥.',
                    link: 'metodologia.html',
                    linkText: 'Nuestra Metodolog√≠a √âtica'
                },
                {
                    keys: ['mapa', 'donde', 'hitos', 'ubicacion', 'hitos', 'georreferencia'],
                    text: 'En nuestro mapa interactivo puedes tocar la historia. Descubre los hitos georreferenciados de nuestra ciudad, desde la Estaci√≥n hasta el Teatro.',
                    link: 'mapa.html',
                    linkText: 'Explorar el Mapa'
                },
                {
                    keys: ['alcalde', 'alcaldesa', 'autoridad', 'solar', 'nieves', 'spoerer'],
                    text: 'Parral ha sido guiado por muchas manos. Desde Domingo Antonio Solar, nuestro primer alcalde en 1912, hasta Nieves Spoerer, la mujer que rompi√≥ esquemas en 1953.',
                    link: 'alcaldes.html',
                    linkText: 'Ver L√≠nea de Alcaldes'
                },
                {
                    keys: ['turismo', 'visitar', 'digua', 'catillo', 'termas', 'naturaleza'],
                    text: 'El alma de Parral tambi√©n est√° en su tierra: las aguas curativas de Catillo y el espejo azul del Embalse Digua te esperan para sanar el esp√≠ritu.',
                    link: 'turismo.html',
                    linkText: 'Ver Destinos Tur√≠sticos'
                },
                {
                    keys: ['historia', 'fundaci√≥n', '1795', 'reina luisa', 'perquilauqu√©n', 'puente', 'ferrocarril', 'tren', '1939', 'terremoto'],
                    text: 'Fundada en 1795 como Villa Reina Luisa por Ambrosio O\'Higgins, nuestra historia es de resiliencia: sobrevivimos al terremoto de 1939 y cruzamos el gigante de acero de Perquilauqu√©n.',
                    link: 'historia.html',
                    linkText: 'Explorar L√≠nea de Tiempo'
                },
                {
                    keys: ['evento', 'calendario', 'feria', 'vendimia', 'semana parralina'],
                    text: '¬°Ven a celebrar con nosotros! La Semana Parralina en febrero y la Fiesta de la Vendimia en marzo son el latido vivo de nuestra cultura hoy.',
                    link: 'turismo.html',
                    linkText: 'Ver Calendario'
                },
                {
                    keys: ['participa', 'ayudar', 'colaborar', 'donar', 'fotos'],
                    text: 'La memoria la construimos todos. Si tienes fotos o relatos de tus abuelos, √∫nete a nuestro Archivo en Movimiento para que no se pierdan en el tiempo.',
                    link: 'participa.html',
                    linkText: '¬°Participa aqu√≠!'
                }
            ];

            function normalizeText(text) {
                return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();
            }

            function getLevenshteinDistance(a, b) {
                const matrix = [];
                for (let i = 0; i <= b.length; i++) matrix[i] = [i];
                for (let j = 0; j <= a.length; j++) matrix[0][j] = j;
                for (let i = 1; i <= b.length; i++) {
                    for (let j = 1; j <= a.length; j++) {
                        if (b.charAt(i - 1) === a.charAt(j - 1)) {
                            matrix[i][j] = matrix[i - 1][j - 1];
                        } else {
                            matrix[i][j] = Math.min(matrix[i - 1][j - 1] + 1, Math.min(matrix[i][j - 1] + 1, matrix[i - 1][j] + 1));
                        }
                    }
                }
                return matrix[b.length][a.length];
            }

            function handleBotResponse(input) {
                const normalizedQuery = normalizeText(input);
                const queryWords = normalizedQuery.split(/\s+/);

                let match = knowledgeBase.find(item => {
                    return item.keys.some(key => {
                        const normKey = normalizeText(key);
                        // 1. Coincidencia exacta o contenida
                        if (normalizedQuery.includes(normKey)) return true;

                        // 2. Coincidencia difusa por palabra
                        return queryWords.some(word => {
                            if (word.length < 4) return false; // Evitar falsos positivos en palabras cortas
                            const distance = getLevenshteinDistance(word, normKey);
                            // Permitir 1 error en palabras de 4-6 letras, 2 en m√°s largas
                            const maxError = normKey.length > 6 ? 2 : 1;
                            return distance <= maxError;
                        });
                    });
                });

                setTimeout(() => {
                    if (match) {
                        addMessage(match.text, 'bot', match.link, match.linkText);
                    } else {
                        addMessage('Mis susurros no contienen esa historia espec√≠fica a√∫n, pero puedes buscar en nuestras sendas principales o enviarnos tu propio relato para que la memoria crezca.', 'bot');
                    }
                }, 600);
            }

            sendBtn.addEventListener('click', () => {
                const text = chatInput.value.trim();
                if (text) {
                    addMessage(text, 'user');
                    chatInput.value = '';
                    handleBotResponse(text);
                }
            });

            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendBtn.click();
            });
        })();
    </script>
    <script>
        // Mobile Menu Toggle
        document.querySelector('.mobile-menu-btn').addEventListener('click', function () {
            document.querySelector('.main-nav').classList.toggle('show');
        });
    </script>
</body>

</html>